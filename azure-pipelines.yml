trigger:
- main

pool:
  name: 'self-hosted'

steps:
- script: |
    set -e

    echo "Agent info:"
    uname -a || true

    echo "Java:"
    java -version

    echo "Maven Wrapper:"
    chmod +x ./mvnw
    ./mvnw -v

    echo "Run tests:"
    ./mvnw -B clean test
  displayName: 'Run unit tests (Maven Wrapper)'

- task: PublishTestResults@2
  displayName: 'Publish JUnit test results'
  condition: succeededOrFailed()
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/target/surefire-reports/TEST-*.xml'
    failTaskOnFailedTests: true
